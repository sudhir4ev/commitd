---
import Layout from '@layouts/Layout.astro'
import Container from '@components/Container.astro'
import { SITE, HOME, SOCIALS } from '@consts'
import ArrowCard from '@components/ArrowCard.astro'
import Link from '@components/Link.astro'
import { getCollection, render } from 'astro:content'
import type { CollectionEntry } from 'astro:content'

type PostOrProject = CollectionEntry<'posts'> | CollectionEntry<'projects'>

const [introEntries, posts, projects] = await Promise.all([
  getCollection('intro'),
  getCollection('posts'),
  getCollection('projects'),
])
const introEntry = introEntries[0]
const { Content: IntroContent } = introEntry ? await render(introEntry) : { Content: null }

const filteredPosts = posts.filter((p) => !p.data.draft)
const filteredProjects = projects.filter((p) => !p.data.draft)

const recent: PostOrProject[] = [...filteredPosts, ...filteredProjects]
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE + SITE.NUM_PROJECTS_ON_HOMEPAGE)
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <aside data-pagefind-ignore>
      <div class="space-y-16">
        <section>
          <article class="space-y-4">
            {IntroContent && <IntroContent />}
          </article>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
            <h2 class="font-semibold text-black dark:text-white">Latest</h2>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              recent.map((entry) => (
                <li>
                  <ArrowCard entry={entry} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate space-y-4">
          <h2 class="font-semibold text-black dark:text-white">Let's Connect</h2>
          <article>
            <p>
              If you want to get in touch with me about something or just to say hi, reach out on social media or send
              me an email.
            </p>
          </article>
          <ul class="not-prose flex flex-wrap gap-2">
            {
              SOCIALS.map((SOCIAL) => (
                <li class="flex gap-x-2 text-nowrap">
                  <Link href={SOCIAL.HREF} external aria-label={`${SITE.TITLE} on ${SOCIAL.NAME}`}>
                    {SOCIAL.NAME}
                  </Link>
                  {'/'}
                </li>
              ))
            }
            <li class="line-clamp-1">
              <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.TITLE}`}>
                {SITE.EMAIL}
              </Link>
            </li>
          </ul>
        </section>
      </div>
    </aside>
  </Container>
</Layout>
